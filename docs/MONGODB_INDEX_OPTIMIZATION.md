# MongoDB 索引优化

## 索引配置

本项目使用以下索引优化查询性能：

### laws 集合

| 索引名称 | 字段 | 类型 | 用途 |
|---------|------|------|------|
| idx_law_id | law_id | 唯一索引 | 法规ID快速查询 |
| idx_category_level_status | category, level, status | 复合索引 | 分类筛选 |
| idx_effect_date | effect_date | 普通索引 | 按实施日期排序 |

### law_articles 集合

| 索引名称 | 字段 | 类型 | 用途 |
|---------|------|------|------|
| idx_law_article_unique | law_id, article_num | 唯一复合索引 | 条文唯一性 |
| idx_law_id | law_id | 普通索引 | 获取单个法规的所有条文 |

## 搜索策略

### 为什么使用正则表达式搜索？

经过测试，MongoDB 自带的文本索引 (`$text`) 对中文支持**严重不足**：

| 搜索词 | 文本索引结果 | 正则表达式结果 | 准确率 |
|-------|------------|--------------|-------|
| "拘留" | 8 条 | 260+ 条 | 3% |
| "取保候审" | 5 条 | 150+ 条 | 3% |

**原因**：MongoDB 文本索引基于空格分词，而中文没有空格分隔词语，导致大量结果被漏掉。

### 当前搜索实现

```python
# 使用正则表达式确保100%准确性
search_query = {"content": {"$regex": query, "$options": "i"}}
```

**优点**：
- ✅ 100% 搜索准确性
- ✅ 支持任意子字符串匹配
- ✅ 不会漏掉任何结果

**性能**：
- 约 100-300ms（对于 ~1万条数据）
- 用户体验完全可接受

## 数据规模评估

| 当前规模 | 说明 |
|---------|------|
| 法律数量 | ~50 部 |
| 每部条文 | ~150-200 条 |
| 总条文数 | ~7,500 - 10,000 条 |

**结论**：当前数据规模较小，正则表达式搜索完全足够，无需引入额外的搜索引擎。

## 未来扩展建议

当数据量增长到 **5万条以上** 且出现明显性能问题时，可考虑：

1. **Elasticsearch**：专业全文搜索引擎，支持 IK 中文分词，需要额外部署服务
2. **应用层缓存**：缓存热门搜索结果，减少数据库压力

> **重要原则**：搜索准确性优先于性能。不要过度工程化。

## 创建索引

索引会在数据导入时自动创建，见 `crawler/import_data.py`。
